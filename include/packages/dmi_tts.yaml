dmi_tts:
  rest:
    - resource: http://rest.apptoo.dk/dmi_tts.json
      sensor:
        - name: DMI Landsudsigt
          force_update: true
          value_template: Fyn
          json_attributes:
            - title
            - last_update
            - forecast

        - name: DMI Fyn
          force_update: true
          value_template: Fyn
          json_attributes_path: "$.region_forecast[?(@.region_name == 'Fyn')]"
          json_attributes:
            - region_name
            - title
            - last_update
            - forecast

        - name: DMI ALT
          force_update: true
          value_template: DMI ALT
          json_attributes:
            - title
            - last_update
            - forecast
            - regions
            - region_forecast

  automation:
    - id: 7416545a41eb4e31a87bbf6e1bc98ecc
      alias: "DMI TTS Scrape (/config/include/packages/dmi_tts.yaml)"
      description: "Scrape dagens vejrudsigter, vent p√• data er klar"
      initial_state: true
      mode: single
      trigger:
        - platform: time_pattern
          minutes: 40
        - platform: webhook
          webhook_id: 0d0efa443c5347198b0e4e44d5c9aaeb
      action:
        - choose:
            - conditions: "{{ trigger.platform == 'webhook' }}"
              sequence:
                - service: shell_command.parsehub_upload
                  data:
                    project_token: !secret DMI_TTS_TOKEN
                    filename: dmi_tts.json

          default:
            - service: shell_command.parsehub_scrape
              data:
                api_key: !secret PARSEHUB_API_KEY
                project_token: !secret DMI_TTS_TOKEN