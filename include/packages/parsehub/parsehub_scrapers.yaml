parsehub_scrapers:
  shell_command:
    parsehub_scrape: "curl -X POST -d api_key={{ api_key }} https://www.parsehub.com/api/v2/projects/{{ project_token }}/run"
    parsehub_upload: "bash /config/shell/parsehub_upload.sh {{ project_token }} {{ filename }}"

  automation:
    - id: 7416545a41eb4e31a87bbf6e1bc98ecc
      alias: "DMI TTS Scrape (/config/include/packages/dmi_tts.yaml)"
      description: "Scrape dagens vejrudsigter, vent p√• data er klar"
      initial_state: true
      mode: single
      trigger:
        - platform: time_pattern
          minutes: 40
        - platform: webhook
          webhook_id: 0d0efa443c5347198b0e4e44d5c9aaeb
      action:
        - choose:
            - conditions: "{{ trigger.platform == 'webhook' }}"
              sequence:
                - service: shell_command.parsehub_upload
                  data:
                    project_token: !secret DMI_TTS_TOKEN
                    filename: dmi_tts.json

          default:
            - service: shell_command.parsehub_scrape
              data:
                api_key: !secret PARSEHUB_API_KEY
                project_token: !secret DMI_TTS_TOKEN  

    - id: a8b72a983358401db7411412b7c03855
      alias: "Fuelfinder.dk scrape"
      description: "Gently scrape fuelfinder for gasprices."
      initial_state: true
      mode: single
      trigger:
        - platform: time_pattern
          minutes: 15
        - platform: webhook
          webhook_id: 7de6f7faf9a14a669d3756aab8a5abd7
      condition:
        alias: "Mellem 11:15 og 17:15"
        condition: time
        after: "11:15:00"
        before: "17:15:00"
      action:
        - choose:
            - conditions: "{{ trigger.platform == 'webhook' }}"
              sequence:
                - service: shell_command.parsehub_upload
                  data:
                    project_token: !secret FUELFINDER_DK_TOKEN
                    filename: fuelfinder.json
                - delay: 5
                - service: homeassistant.update_entity
                  entity_id:
                    - sensor.ok_95
                    - sensor.ok_diesel

          default:
            - service: shell_command.parsehub_scrape
              data:
                api_key: !secret PARSEHUB_API_KEY
                project_token: !secret FUELFINDER_DK_TOKEN
  
    - id: 4c3571524125428aa8b1eed545ac2588
      alias: "Bold.dk scrape (/config/include/packages/soccer.yaml)"
      description: "Scrape bold.dk"
      initial_state: true
      mode: single
      trigger:
        - platform: time_pattern
          minutes: 40
        - platform: webhook
          webhook_id: 44854163446448d9b1ce1adf2412d84e
      action:
        - choose:
            - conditions: "{{ trigger.platform == 'webhook' }}"
              sequence:
                - service: shell_command.parsehub_upload
                  data:
                    project_token: !secret BOLD_DK_TOKEN
                    filename: soccer.json
                - delay: 5
                - service: homeassistant.update_entity
                  entity_id:
                    - sensor.superligaen
                    - sensor.premier_league

          default:
            - service: shell_command.parsehub_scrape
              data:
                api_key: !secret PARSEHUB_API_KEY
                project_token: !secret BOLD_DK_TOKEN